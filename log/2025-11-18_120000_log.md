# 2025-11-18 12:00:00 修改記錄

- 作者: GitHub Copilot (由助理自動產生)
- 檔案: `video_pipeline/config.py`
- 修改摘要（簡短說明）:
  1. 移除 `os.getenv(...)` 作為 `BaseSettings` 欄位的預設值。
  2. 將 API key 欄位改為 `Optional[str] = None`，改由 `pydantic-settings` 讀取環境或 `.env`。
  3. 將 `BASE_DIR` 改為 `Path(__file__).parent.resolve()` 以取得絕對路徑。
  4. 將 `Config.env_file` 改為 `.env` 的絕對路徑（`str(Path(__file__).parent.resolve() / ".env")`）。
  5. 保留原有的三個資料夾建立邏輯（`uploads`, `outputs`, `temp`）。

- 變更原因（簡述）:
  - 避免在模組匯入階段使用 `os.getenv` 導致讀不到 `.env` 的情況，改讓 `BaseSettings` 負責讀取環境與 `.env`。
  - 使用絕對路徑可以減少因工作目錄不同而產生的路徑問題。

- 重要片段（修改前 vs 修改後，簡略）：

  修改前（原始片段）:

  ```py
  OPENAI_API_KEY: str = os.getenv("OPENAI_API_KEY", "")
  BASE_DIR: Path = Path(__file__).parent
  class Config:
      env_file = ".env"
  ```

  修改後（目前內容）:

  ```py
  from typing import Optional
  OPENAI_API_KEY: Optional[str] = None
  BASE_DIR: Path = Path(__file__).parent.resolve()
  class Config:
      env_file = str(Path(__file__).parent.resolve() / ".env")
  ```

- 備註:
  - 請確認 `requirements.txt` 中有 `pydantic-settings`（或 `pydantic>=2`）以支援 `BaseSettings` 的行為。
  - 如需我也加入啟動時檢查必要 API key 的邏輯（有些 key 若為必需應在啟動時提醒或 raise），可回覆我執行。

---
(自動產生日誌)


## 修改後的原始程式碼（含行號）

下面是 `video_pipeline/config.py` 修改後的完整內容，左側為行號（1 開始）：

```py
 1: """
 2: 配置文件 - API keys 同路徑
 3: """
 4: from typing import Optional
 5: from pathlib import Path
 6: from pydantic_settings import BaseSettings
 7: 
 8: 
 9: class Settings(BaseSettings):
10:     # API Keys (讓 pydantic-settings 負責從環境或 .env 讀取)
11:     OPENAI_API_KEY: Optional[str] = None
12:     QWEN_API_KEY: Optional[str] = None
13:     ELEVENLABS_API_KEY: Optional[str] = None
14:     SUNO_API_KEY: Optional[str] = None
15:     IMAGE_GEN_API_KEY: Optional[str] = None  # Stability AI / DALL-E
16:     VIDEO_GEN_API_KEY: Optional[str] = None  # Runway / Pika
17:     
18:     # API Endpoints
19:     QWEN_API_URL: str = "https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation"
20:     OPENAI_API_URL: str = "https://api.openai.com/v1/chat/completions"
21:     ELEVENLABS_API_URL: str = "https://api.elevenlabs.io/v1/text-to-speech"
22:     SUNO_API_URL: str = "https://api.suno.ai/v1/generate"
23:     
24:     # 路徑
25:     BASE_DIR: Path = Path(__file__).parent.resolve()
26:     UPLOAD_DIR: Path = BASE_DIR / "uploads"
27:     OUTPUT_DIR: Path = BASE_DIR / "outputs"
28:     TEMP_DIR: Path = BASE_DIR / "temp"
29:     
30:     # 模型設定
31:     WHISPER_MODEL: str = "large-v3"  # or "base", "small", "medium"
32:     GPT_MODEL: str = "gpt-4o"
33:     
34:     # 其他參數
35:     MAX_RETRIES: int = 3
36:     TIMEOUT: int = 300  # 5 分鐘
37:     
38:     # 語言 (用作 syllable counting)
39:     LANGUAGE: str = "zh-TW"  # 或 "en", "zh-CN"
40:     
41:     class Config:
42:         env_file = str(Path(__file__).parent.resolve() / ".env")
43:         case_sensitive = True
44: 
45: 
46: settings = Settings()
47: 
48: # 建立必要資料夾
49: for folder in [settings.UPLOAD_DIR, settings.OUTPUT_DIR, settings.TEMP_DIR]:
50:     folder.mkdir(parents=True, exist_ok=True)
```
